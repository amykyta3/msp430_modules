<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>A Library of MSP430 C Code: Basic Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">A Library of MSP430 C Code
   </div>
   <div id="projectbrief">Collection of peripheral drivers, component drivers, utilities, and other commonly used embedded code.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Basic Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#SEC_EX_BAS1">1. Introduction</a></li>
<li class="level1"><a href="#SEC_EX_BAS2">2. Description</a><ul><li class="level2"><a href="#SEC_EX_BAS2_1">2.1 The main() Routine</a></li>
<li class="level2"><a href="#SEC_EX_BAS2_2">2.2 Timer events</a></li>
<li class="level2"><a href="#SEC_EX_BAS2_3">2.3 Pushbutton Events</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Blink some LEDs using a timer and control them with pushbuttons.</p>
<h1><a class="anchor" id="SEC_EX_BAS1"></a>
1. Introduction</h1>
<dl class="section user"><dt></dt><dd>This example demonstrates some basic modules and can be run without modifications on TI's <a href="http://www.ti.com/tool/msp-exp430f5529lp">MSP430F5529 LaunchPad</a> or the <a href="http://www.ti.com/tool/msp-exp430fg4618">MSP430FG4618/F2013 Experimenter Board</a>. Choosing between the two can be done by uncommenting the appropriate processor variable in the Makefile.</dd></dl>
<dl class="section user"><dt></dt><dd>If you don't have either of the kits, all you need is an MSP430 connected to:<ul>
<li>Two LEDs</li>
<li>Two pushbuttons</li>
<li>A 32.768 kHz crystal on XT1.</li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>This example demonstrates the use of the following modules:<ul>
<li><a class="el" href="group___m_o_d___c_l_o_c_k_s_y_s.html">Clock System</a></li>
<li><a class="el" href="group___m_o_d___e_v_e_n_t___q_u_e_u_e.html">Event Queue</a> which also uses <a class="el" href="group___m_o_d___f_i_f_o.html">FIFO Ring Buffer</a> internally.</li>
<li><a class="el" href="group___m_o_d___b_u_t_t_o_n.html">Pushbutton Events</a></li>
<li><a class="el" href="group___m_o_d___t_i_m_e_r.html">Timer</a></li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>In this example, a timer is used to blink two LEDs at different rates. Two pushbuttons pause and resume one of the LED's blinking.</dd></dl>
<h1><a class="anchor" id="SEC_EX_BAS2"></a>
2. Description</h1>
<dl class="section user"><dt></dt><dd>First, several header files are included:  <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="msp430__xc_8h.html">msp430_xc.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="clock__sys_8h.html">clock_sys.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="event__queue_8h.html">event_queue.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="button_8h.html">button.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">timer.h</a>&gt;</span></div></div><!-- fragment --> The <a class="el" href="msp430__xc_8h.html" title="MSP430 Cross-Compiler Header. ">msp430_xc.h</a> header is just like TI's msp430.h header except that it also provides several compatibility macros between the TI and GCC compilers.</dd></dl>
<dl class="section user"><dt></dt><dd>In this example, the preprocessor is used to control port configuration of the two development boards. If compiling for the x5529, pins will be set up for the Launchpad. If compiling for the x4618, settings for the Experimenter's board will be assumed. <div class="fragment"><div class="line"><span class="preprocessor">#if defined(__MSP430F5529__)</span></div><div class="line">    <span class="comment">// Compiling for MSP430F5529. Assuming this is for the USB Launchpad dev board</span></div><div class="line">    <span class="comment">// MSP-EXP430F5529LP</span></div><div class="line"><span class="preprocessor">    #define BOARD_MSP_EXP430F5529LP</span></div><div class="line">    </div><div class="line"><span class="preprocessor">#elif defined(__MSP430F4618__)</span></div><div class="line">    <span class="comment">// Compiling for MSP430F4618. Assuming this is for the MSP430 Experimenter Board</span></div><div class="line">    <span class="comment">// MSP-EXP430FG4618</span></div><div class="line"><span class="preprocessor">    #define BOARD_MSP_EXP430FG4618</span></div><div class="line">    </div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor">    #error Board not supported. Please enter your own board settings</span></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --></dd></dl>
<h2><a class="anchor" id="SEC_EX_BAS2_1"></a>
2.1 The main() Routine</h2>
<dl class="section user"><dt></dt><dd>At the start of the main() routine, the board_init() function is called where the ports for the two LEDs are configured. Next, all of the modules being used are initialized: <div class="fragment"><div class="line">        <a class="code" href="group___m_o_d___c_l_o_c_k_s_y_s.html#ga78ab77b57cf2e00089f0a3a22508524c">clock_init</a>();</div><div class="line">        <a class="code" href="group___m_o_d___e_v_e_n_t___q_u_e_u_e.html#ga703aee6d18b09a8b0e7fa762e6024594">event_init</a>();</div><div class="line">        <a class="code" href="group___m_o_d___b_u_t_t_o_n.html#ga9ebb64bc3ea7a1e75d422784fe931347">button_init</a>();</div><div class="line">        <a class="code" href="group___m_o_d___t_i_m_e_r.html#ga7b8ab79df77b57475a5494f5f81c3bd9">timer_init</a>();</div><div class="line">        </div><div class="line">        <a class="code" href="group___m_o_d___b_u_t_t_o_n.html#ga21bf8bc834c318ebaa1e1616fd3fdf82">button_SetupPort</a>(BIT1, BIT1, 2);</div><div class="line">        <a class="code" href="group___m_o_d___b_u_t_t_o_n.html#ga21bf8bc834c318ebaa1e1616fd3fdf82">button_SetupPort</a>(BIT1, BIT1, 1);</div></div><!-- fragment --> <a class="el" href="group___m_o_d___c_l_o_c_k_s_y_s.html#ga78ab77b57cf2e00089f0a3a22508524c" title="Initializes the clock system. ">clock_init()</a> is almost always the first module to be initialized since others often depend on its configuration. Next, the remaining modules init routines are called. The <a class="el" href="group___m_o_d___b_u_t_t_o_n.html">Pushbutton Events</a> module is set up to respond to buttons on P2.1 and P1.1. Since these are active-low pull-down buttons, inversion of those bits is enabled.</dd></dl>
<dl class="section user"><dt></dt><dd>Next, two timers are initialized and started with different intervals. For the first timer, a trigger period of 400 milliseconds is used. The timer is set to repeat indefinitely. Whenever the timer expires, it will trigger the event function OnTimerExpire1(). <div class="fragment"><div class="line">    <span class="keyword">struct </span><a class="code" href="structtimerctl.html">timerctl</a> timer_settings;</div><div class="line">    </div><div class="line">    timer_settings.<a class="code" href="structtimerctl.html#a479c76185111b28fb184455ae1febceb">interval_ms</a> = 400;</div><div class="line">    timer_settings.repeat = <span class="keyword">true</span>;</div><div class="line">    timer_settings.fptr = OnTimerExpire1;</div><div class="line">    timer_settings.ev_data = NULL;</div><div class="line">    <a class="code" href="group___m_o_d___t_i_m_e_r.html#gae03a3f3061a7ad02616ebaa6fd74ada2">timer_start</a>(&amp;Timer1,&amp;timer_settings);</div></div><!-- fragment --> The second timer is identical except it uses an interval of 500 ms</dd></dl>
<dl class="section user"><dt></dt><dd>Finally, since the pushbuttons and the three timers will be generating events, the event handler must be started. <div class="fragment"><div class="line">    __enable_interrupt();</div><div class="line">    <a class="code" href="group___m_o_d___e_v_e_n_t___q_u_e_u_e.html#gaf859b36463aafa4644f13fc892998a27">event_StartHandler</a>();</div></div><!-- fragment --> <b>Note:</b> The <a class="el" href="group___m_o_d___e_v_e_n_t___q_u_e_u_e.html#gaf859b36463aafa4644f13fc892998a27" title="Starts the event handler. ">event_StartHandler()</a> routine does not return. This contains the main loop for the program. Everything else is now handled using events and interrupts.</dd></dl>
<dl class="section user"><dt></dt><dd>That is all for the main() routine!</dd></dl>
<h2><a class="anchor" id="SEC_EX_BAS2_2"></a>
2.2 Timer events</h2>
 <dl class="section user"><dt></dt><dd>Each of the timers have been set up to trigger their own separate events. All that each event function does is toggle the state of each of the LEDs. <div class="fragment"><div class="line"><span class="keywordtype">void</span> OnTimerExpire1(<span class="keywordtype">void</span> *data){</div><div class="line">    <span class="comment">// Left LED</span></div><div class="line">    LED1_PORT_OUT ^= P_LED1_bm;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> OnTimerExpire2(<span class="keywordtype">void</span> *data){</div><div class="line">    <span class="comment">// Right LED</span></div><div class="line">    LED2_PORT_OUT ^= P_LED2_bm;</div><div class="line">}</div></div><!-- fragment --></dd></dl>
<h2><a class="anchor" id="SEC_EX_BAS2_3"></a>
2.3 Pushbutton Events</h2>
<dl class="section user"><dt></dt><dd>Lastly we want the two pushbuttons to do something. The following code makes one pushbutton start the first timer and the other button stops the timer. <div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___m_o_d___b_u_t_t_o_n.html#gac39c578a481cc9fae18244df630c5ffa">onButtonDown</a>(uint8_t port, uint8_t b){</div><div class="line"><span class="preprocessor">    #if defined(BOARD_MSP_EXP430F5529LP)</span></div><div class="line">        <span class="keywordflow">if</span>((port == 2) &amp;&amp; (b &amp; BIT1)){</div><div class="line">            <span class="comment">// Left button</span></div><div class="line">            <a class="code" href="group___m_o_d___t_i_m_e_r.html#gae03a3f3061a7ad02616ebaa6fd74ada2">timer_start</a>(&amp;Timer1,NULL);</div><div class="line">        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>((port == 1) &amp;&amp; (b &amp; BIT1)){</div><div class="line">            <span class="comment">// Right button</span></div><div class="line">            <a class="code" href="group___m_o_d___t_i_m_e_r.html#gac8571f4281a5dac60d542cfc972218ad">timer_stop</a>(&amp;Timer1);</div><div class="line">        }</div><div class="line"><span class="preprocessor">    #elif defined(BOARD_MSP_EXP430FG4618)</span></div><div class="line">        <span class="keywordflow">if</span>(b &amp; BIT1){</div><div class="line">            <span class="comment">// Left button</span></div><div class="line">            <a class="code" href="group___m_o_d___t_i_m_e_r.html#gae03a3f3061a7ad02616ebaa6fd74ada2">timer_start</a>(&amp;Timer1,NULL);</div><div class="line">        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(b &amp; BIT0){</div><div class="line">            <span class="comment">// Right button</span></div><div class="line">            <a class="code" href="group___m_o_d___t_i_m_e_r.html#gac8571f4281a5dac60d542cfc972218ad">timer_stop</a>(&amp;Timer1);</div><div class="line">        }</div><div class="line"><span class="preprocessor">    #endif</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___m_o_d___b_u_t_t_o_n.html#ga9b5c1ebd17957ac1f586288ba9b81db9">onButtonUp</a>(uint8_t port, uint8_t b){</div><div class="line">    </div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group___m_o_d___b_u_t_t_o_n.html#ga61f25646f0b5a07c6e0ea6d970de31b1">onButtonHold</a>(uint8_t port, uint8_t b){</div><div class="line">    </div><div class="line">}</div></div><!-- fragment --> The other two events, <a class="el" href="group___m_o_d___b_u_t_t_o_n.html#ga9b5c1ebd17957ac1f586288ba9b81db9" title="Button-up event. ">onButtonUp()</a> and <a class="el" href="group___m_o_d___b_u_t_t_o_n.html#ga61f25646f0b5a07c6e0ea6d970de31b1" title="Button-hold event. ">onButtonHold()</a> remain unused in this example. </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Feb 12 2018 21:23:53 for A Library of MSP430 C Code by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
